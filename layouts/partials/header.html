<header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all">
  <nav class="px-2 py-3 lg:py-5 container mx-auto lg:px-0">
    <div class="flex flex-wrap justify-between items-center">
      <a href="{{ .Site.BaseURL | safeURL }}" class="flex items-center">
        <img src='{{ .Site.Params.light_logo | relURL }}' class="mr-3 h-6 sm:h-9 dark:hidden"
          alt="{{ .Site.Title }} Logo" />
        <img src='{{ .Site.Params.dark_logo | relURL }}' class="mr-3 h-6 sm:h-9 hidden dark:block"
          alt="{{ .Site.Title }} Logo" />
      </a>
      <div class="flex items-center lg:order-2">
        <div class="p-2 lg:mr-2 cursor-pointer"
          onclick="changeTheme()">
          <div class="hidden dark:block text-slate-200">
            <svg fill="currentColor" class="size-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M375.7 19.7c-1.5-8-6.9-14.7-14.4-17.8s-16.1-2.2-22.8 2.4L256 61.1 173.5 4.2c-6.7-4.6-15.3-5.5-22.8-2.4s-12.9 9.8-14.4 17.8l-18.1 98.5L19.7 136.3c-8 1.5-14.7 6.9-17.8 14.4s-2.2 16.1 2.4 22.8L61.1 256 4.2 338.5c-4.6 6.7-5.5 15.3-2.4 22.8s9.8 13 17.8 14.4l98.5 18.1 18.1 98.5c1.5 8 6.9 14.7 14.4 17.8s16.1 2.2 22.8-2.4L256 450.9l82.5 56.9c6.7 4.6 15.3 5.5 22.8 2.4s12.9-9.8 14.4-17.8l18.1-98.5 98.5-18.1c8-1.5 14.7-6.9 17.8-14.4s2.2-16.1-2.4-22.8L450.9 256l56.9-82.5c4.6-6.7 5.5-15.3 2.4-22.8s-9.8-12.9-17.8-14.4l-98.5-18.1L375.7 19.7zM269.6 110l65.6-45.2 14.4 78.3c1.8 9.8 9.5 17.5 19.3 19.3l78.3 14.4L402 242.4c-5.7 8.2-5.7 19 0 27.2l45.2 65.6-78.3 14.4c-9.8 1.8-17.5 9.5-19.3 19.3l-14.4 78.3L269.6 402c-8.2-5.7-19-5.7-27.2 0l-65.6 45.2-14.4-78.3c-1.8-9.8-9.5-17.5-19.3-19.3L64.8 335.2 110 269.6c5.7-8.2 5.7-19 0-27.2L64.8 176.8l78.3-14.4c9.8-1.8 17.5-9.5 19.3-19.3l14.4-78.3L242.4 110c8.2 5.7 19 5.7 27.2 0zM256 368a112 112 0 1 0 0-224 112 112 0 1 0 0 224zM192 256a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z"/></svg>
          </div>
          <div class="dark:hidden text-slate-800">
            <svg fill="currentColor" class="size-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M144.7 98.7c-21 34.1-33.1 74.3-33.1 117.3c0 98 62.8 181.4 150.4 211.7c-12.4 2.8-25.3 4.3-38.6 4.3C126.6 432 48 353.3 48 256c0-68.9 39.4-128.4 96.8-157.3zm62.1-66C91.1 41.2 0 137.9 0 256C0 379.7 100 480 223.5 480c47.8 0 92-15 128.4-40.6c1.9-1.3 3.7-2.7 5.5-4c4.8-3.6 9.4-7.4 13.9-11.4c2.7-2.4 5.3-4.8 7.9-7.3c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-3.7 .6-7.4 1.2-11.1 1.6c-5 .5-10.1 .9-15.3 1c-1.2 0-2.5 0-3.7 0l-.3 0c-96.8-.2-175.2-78.9-175.2-176c0-54.8 24.9-103.7 64.1-136c1-.9 2.1-1.7 3.2-2.6c4-3.2 8.2-6.2 12.5-9c3.1-2 6.3-4 9.6-5.8c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-3.6-.3-7.1-.5-10.7-.6c-2.7-.1-5.5-.1-8.2-.1c-3.3 0-6.5 .1-9.8 .2c-2.3 .1-4.6 .2-6.9 .4z"/></svg>
          </div>
        </div>
        {{ with .Site.Params.header_login_btn }}
        <a href="{{ .url | relURL }}"
          class="hidden lg:block text-black dark:text-white hover:bg-style hover:text-black hover:after:p-0 rounded-3xl after:rounded-3xl font-medium text-sm px-5 py-3 hover:scale-105 transition-all mr-2 border-gradient-primary font-poppins">{{
          .label }}</a>
        {{ end }}
        {{ with .Site.Params.cta_btn }}
        <a href="{{ .url | relURL }}"
          class="hidden lg:block rounded-3xl font-medium text-sm px-5 py-3 hover:scale-105 transition-all font-poppins bg-style after-right-arrow after:relative after:top-[3px] after:left-[5px]">{{
          .label }}</a>
        {{ end }}
        <button data-collapse-toggle="mobile-menu-2" type="button"
          class="inline-flex items-center p-2 ml-1 text-sm text-black dark:text-white rounded-lg lg:hidden focus:outline-none"
          aria-controls="mobile-menu-2" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"></path>
          </svg>
          <svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
      <div class="hidden justify-center items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2">
        <ul class="flex flex-col mt-4 lg:flex-row lg:mt-0 justify-center items-center lg:space-x-5">
          {{ $current := . }}
          {{ range $index, $item := site.Menus.main }}
          {{ $menu := .URL | absURL }}
          {{ $page := $current.RelPermalink | absURL }}
          {{ $active := eq $menu $page }}

          {{ if .HasChildren }}
          <div class="group relative inline-block text-left w-full px-4 lg:p-0">
            <button
            {{ $light_arrow := "images/dev/light_arrow_down.png" | relURL }}
            {{ $dark_arrow := "images/dev/dark_arrow_down.png" | relURL }}
              class="py-2 text-main font-normal dark:text-slate-100 hover:text-slate-950 dark:hover:text-white rounded lg:bg-transparent lg:text-primary-700 lg:p-0 font-poppins w-full flex gap-1 justify-between lg:justify-normal items-center text-start transition-transform duration-500 tracking-wider"
              aria-haspopup="true" aria-expanded="false">
              <a href="{{ .URL | absURL }}">
                {{ .Name }}
              </a>
              <div id="dropdown-button-{{ $index }}">
                <img src="{{ $light_arrow }}" alt="" class="dark:hidden lg:min-w-[12px]">
                <img src="{{ $dark_arrow }}" alt="" class="hidden dark:block lg:min-w-[12px]">  
              </div>
            </button>

            <div id="dropdown-menu-{{ $index }}"
              class="relative origin-top lg:absolute lg:translate-y-3 lg:group-hover:translate-y-2 lg:opacity-0 lg:block lg:group-hover:opacity-100 lg:transition-all lg:duration-300 w-full lg:w-64 rounded-md shadow-lg bg-main border border-slate-800 ring-opacity-5 lg:left-1/2 lg:-translate-x-1/2 hidden">
              <div class="w-7 overflow-hidden fixed left-1/2 -translate-x-1/2 -mt-4 hidden lg:inline">
                <div class=" h-4 w-4 bg-main rotate-45 transform origin-bottom-left"></div>
               </div>
              <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="dropdown-button-{{ $index }}">
                {{ range .Children }}
                {{ $childMenu := .URL | absURL }}
                {{ $childPage := $current.RelPermalink | absURL }}
                {{ $childActive := eq $childMenu $childPage }}
                <a href="{{ .URL | absURL }}"
                  class="w-full lg:w-auto text-slate-100 hover:text-slate-300 transition-colors block px-5 py-1 mb-1 text-sm rounded-md tracking-wider {{ if $childActive }}font-bold{{ else }}font-normal{{ end }}"
                  role="menuitem">{{ .Name }}</a>
                {{ end }}
              </div>
            </div>
          </div>
          {{ else }}
          <li class="w-full lg:text-center">
            <a href="{{ .URL | absURL }}"
              class="{{ if $active }}font-bold{{ else }}font-normal{{ end }} whitespace-nowrap block py-2 px-4 text-slate-950 hover:text-slate-800 dark:text-slate-100 dark:hover:text-slate-300 transition-colors rounded lg:bg-transparent lg:text-primary-700 lg:p-0 font-poppins tracking-wider">{{
              .Name }}</a>
          </li>
          {{ end }}
          {{ end }}

          <script>
            // Object to track dropdown states
            const dropdownStates = {};

            // Add event listeners for each dropdown
            document.querySelectorAll('[id^="dropdown-button-"]').forEach((dropdownButton) => {
              const index = dropdownButton.id.split('-').pop();
              const dropdownMenu = document.getElementById(`dropdown-menu-${index}`);

              // Initialize dropdown state for this index
              dropdownStates[index] = false;

              // Function to toggle dropdown visibility
              function toggleDropdown() {
                dropdownStates[index] = !dropdownStates[index];
                if (dropdownStates[index]) {
                  dropdownMenu.classList.remove("hidden");
                } else {
                  dropdownMenu.classList.add("hidden");
                }
              }

              dropdownButton.addEventListener("click", (event) => {
                event.stopPropagation(); // Prevent event from bubbling up to the window
                toggleDropdown();
              });

              // Close the dropdown if clicking outside
              window.addEventListener("click", (event) => {
                if (
                  !dropdownButton.contains(event.target) &&
                  !dropdownMenu.contains(event.target)
                ) {
                  dropdownMenu.classList.add("hidden");
                  dropdownStates[index] = false;
                }
              });
            });
          </script>

          {{ with .Site.Params.header_login_btn }}
          <li class="w-full my-3 lg:hidden">
            <a href="{{ .url | relURL }}"
              class="lg:hidden text-black dark:text-white hover:bg-gradient-primary rounded-3xl after:rounded-3xl font-medium text-sm w-full block text-center py-3 hover:scale-105 transition-all border-gradient-primary font-poppins">{{
              .label }}</a>
          </li>
          {{ end }}
          {{ with .Site.Params.cta_btn }}
          <li class="w-full lg:hidden">
            <a href="{{ .url | relURL }}"
              class="lg:hidden rounded-3xl font-medium text-sm block text-center w-full py-3 hover:scale-105 transition-all font-poppins bg-style after-right-arrow after:relative after:top-[3px] after:left-[5px] hover:after:left-[7px]">{{
              .label }}</a>
          </li>
          {{ end }}
        </ul>
      </div>
    </div>
  </nav>
</header>

<script>
  const menuToggle = document.querySelector(
    '[data-collapse-toggle="mobile-menu-2"]'
  );
  const mobileMenu = document.getElementById("mobile-menu-2");
  const header = document.getElementById("header");

  // Menu function
  menuToggle.addEventListener("click", function () {
    // Toggle the 'show' class on the mobile menu
    mobileMenu.classList.toggle("hidden");
    // When the menu is open, we want to prevent the body from scrolling
    document.body.classList.toggle("overflow-hidden");
    document.body.classList.toggle("md:overflow-auto");

    // Toggle the SVG icons
    const openIcon = menuToggle.querySelector("svg:first-of-type"); // Open icon
    const closeIcon = menuToggle.querySelector("svg:last-of-type"); // Close icon
    openIcon.classList.toggle("hidden");
    closeIcon.classList.toggle("hidden");

    // Check the display of the mobile menu and update header style
    if (window.getComputedStyle(mobileMenu).display === "block") {
      header.classList.add('backdrop-blur-lg');
    } else {
      // Only remove the backdrop filter if the scroll position is not greater than 50
      if (window.scrollY <= 50) {
        header.classList.remove('backdrop-blur-lg');
      } else {
        // Keep the blur if scrolled more than 50
        updateHeaderStyle();
      }
    }
  });

  // Function to update the header style based on scroll position
  function updateHeaderStyle() {
    const header = document.querySelector("header");

    // Apply blur if scrolled more than 50 pixels
    if (window.scrollY > 50) {
      header.classList.add('backdrop-blur-lg');
    } else {
      header.classList.remove('backdrop-blur-lg');
    }
  }

  // Event listener for scroll
  window.addEventListener("scroll", updateHeaderStyle);

  // Check scroll position on page load
  window.addEventListener("load", updateHeaderStyle);
</script>