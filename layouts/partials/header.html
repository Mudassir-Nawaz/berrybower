<header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all">
  <nav class="px-2 py-3 lg:py-5 container mx-auto">
    <div class="flex flex-wrap justify-between items-center">
      <a href="{{ .Site.BaseURL | safeURL }}" class="flex items-center">
        <img src='{{ .Site.Params.light_logo | relURL }}' class="mr-3 h-6 sm:h-8 dark:hidden"
          alt="{{ .Site.Title }} Logo" />
        <img src='{{ .Site.Params.dark_logo | relURL }}' class="mr-3 h-6 sm:h-8 hidden dark:block"
          alt="{{ .Site.Title }} Logo" />
      </a>
      <div class="flex items-center lg:order-2">
        <div class="rounded-full after:rounded-full border-gradient-primary p-2 lg:mr-2 cursor-pointer dark:p-[0.6rem]"
          onclick="changeTheme()">
          <img src='{{ "images/dev/sun.png" | relURL }}' alt="" class="hidden dark:block">
          <img src='{{ "images/dev/moon.png" | relURL }}' alt="" class="dark:hidden">
        </div>
        {{ with .Site.Params.header_login_btn }}
        <a href="{{ .url | relURL }}"
          class="hidden lg:block text-black dark:text-white hover:bg-style hover:text-black hover:after:p-0 rounded-3xl after:rounded-3xl font-medium text-sm px-5 py-3 hover:scale-105 transition-all mr-2 border-gradient-primary font-poppins">{{
          .label }}</a>
        {{ end }}
        {{ with .Site.Params.cta_btn }}
        <a href="{{ .url | relURL }}"
          class="hidden lg:block rounded-3xl font-medium text-sm px-5 py-3 hover:scale-105 transition-all font-poppins bg-style after-right-arrow after:relative after:top-[3px] after:left-[5px]">{{
          .label }}</a>
        {{ end }}
        <button data-collapse-toggle="mobile-menu-2" type="button"
          class="inline-flex items-center p-2 ml-1 text-sm text-black dark:text-white rounded-lg lg:hidden focus:outline-none"
          aria-controls="mobile-menu-2" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"></path>
          </svg>
          <svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
      <div class="hidden justify-center items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2">
        <ul class="flex flex-col mt-4 lg:flex-row lg:space-x-8 lg:mt-0 justify-center items-center">
          {{ $current := . }}
          {{ range $index, $item := site.Menus.main }}
          {{ $menu := .URL | absURL }}
          {{ $page := $current.RelPermalink | absURL }}
          {{ $active := eq $menu $page }}

          {{ if .HasChildren }}
          <div class="group relative inline-block text-left w-full">
            <button id="dropdown-button-{{ $index }}"
              class="py-2 px-4 text-main font-normal dark:text-slate-100 hover:text-slate-950 dark:hover:text-white rounded lg:bg-transparent lg:text-primary-700 lg:p-0 font-poppins after-down-arrow after-down-arrow-dark w-full flex text-start after:absolute after:right-3 lg:after:right-0 lg:after:static lg:after:ml-1 transition-transform duration-500 tracking-wider"
              aria-haspopup="true" aria-expanded="false">
              {{ .Name }}
            </button>

            <div id="dropdown-menu-{{ $index }}"
              class="origin-top lg:absolute lg:translate-y-3 lg:group-hover:translate-y-2 lg:opacity-0 lg:block lg:group-hover:opacity-100 lg:transition-all lg:duration-300 w-full lg:w-56 rounded-md shadow-lg bg-black border border-slate-800 ring-opacity-5 lg:left-1/2 lg:-translate-x-1/2 hidden">
              <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="dropdown-button-{{ $index }}">
                {{ range .Children }}
                {{ $childMenu := .URL | absURL }}
                {{ $childPage := $current.RelPermalink | absURL }}
                {{ $childActive := eq $childMenu $childPage }}
                <a href="{{ .URL | absURL }}"
                  class="w-full lg:w-auto text-slate-100 hover:text-slate-300 transition-colors block px-4 py-1 mb-1 text-sm rounded-md tracking-wider {{ if $childActive }}font-bold{{ else }}font-normal{{ end }}"
                  role="menuitem">{{ .Name }}</a>
                {{ end }}
              </div>
            </div>
          </div>
          {{ else }}
          <li class="w-full">
            <a href="{{ .URL | absURL }}"
              class="{{ if $active }}font-bold{{ else }}font-normal{{ end }} block py-2 px-4 text-slate-950 hover:text-slate-800 dark:text-slate-100 dark:hover:text-slate-300 transition-colors rounded lg:bg-transparent lg:text-primary-700 lg:p-0 font-poppins tracking-wider">{{
              .Name }}</a>
          </li>
          {{ end }}
          {{ end }}

          <script>
            // Object to track dropdown states
            const dropdownStates = {};

            // Add event listeners for each dropdown
            document.querySelectorAll('[id^="dropdown-button-"]').forEach((dropdownButton) => {
              const index = dropdownButton.id.split('-').pop();
              const dropdownMenu = document.getElementById(`dropdown-menu-${index}`);

              // Initialize dropdown state for this index
              dropdownStates[index] = false;

              // Function to toggle dropdown visibility
              function toggleDropdown() {
                dropdownStates[index] = !dropdownStates[index];
                if (dropdownStates[index]) {
                  dropdownMenu.classList.remove("hidden");
                } else {
                  dropdownMenu.classList.add("hidden");
                }
              }

              dropdownButton.addEventListener("click", (event) => {
                event.stopPropagation(); // Prevent event from bubbling up to the window
                toggleDropdown();
              });

              // Close the dropdown if clicking outside
              window.addEventListener("click", (event) => {
                if (
                  !dropdownButton.contains(event.target) &&
                  !dropdownMenu.contains(event.target)
                ) {
                  dropdownMenu.classList.add("hidden");
                  dropdownStates[index] = false;
                }
              });
            });
          </script>

          {{ with .Site.Params.header_login_btn }}
          <li class="w-full my-3">
            <a href="{{ .url | relURL }}"
              class="lg:hidden text-black dark:text-white hover:bg-gradient-primary rounded-3xl after:rounded-3xl font-medium text-sm w-full block text-center py-3 hover:scale-105 transition-all border-gradient-primary font-poppins">{{
              .label }}</a>
          </li>
          {{ end }}
          {{ with .Site.Params.cta_btn }}
          <li class="w-full">
            <a href="{{ .url | relURL }}"
              class="lg:hidden rounded-3xl font-medium text-sm block text-center w-full py-3 hover:scale-105 transition-all font-poppins bg-style after-right-arrow after:relative after:top-[3px] after:left-[5px] hover:after:left-[7px]">{{
              .label }}</a>
          </li>
          {{ end }}
        </ul>
      </div>
    </div>
  </nav>
</header>